<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <!-- React的核心库 -->
    <script src='../build/react.js'></script>
    <!-- 提供与DOM相关的功能 -->
    <script src='../build/react-dom.js'></script>
    <!-- JSX语法转为JavaScript语法 -->
    <script src="../build/browser.min.js"></script>
</head>

<body>
    <div id="app"></div>
    <script type="text/babel">
        // 组件挂载阶段
        // constructor
        // componentWillMount
        // render
        // componentDidMount

        // 组件更新阶段
        // componentWillReceiveProps
                // 在挂载后的组件接收到新属性之前调用
                // 父组件引起组件重新渲染,属性没有任何变化也会触发，所以要比较this.props和nextProps
        // shouldComponentUpdate
        // componentWillUpdate
        // render
        // componentDidUpdate

        // 组件卸载阶段
        // componentWillUnmount

        // setState:
            //  为了提高性能React将setState设置为异步操作函数
            //  在调用setState后并不能立即读取到更新的this.state
            //  1.允许传入第二个参数：回调函数，回调函数会保证应用被更新后触发
            //  2.传入状态计算函数来作为第一个参数（若之后的状态依赖于之前的状态）

        // constructor
        // 构造器constructor()首先被调用 然后通过super改变this指向
        // 在构造器中完成初始化组件属性或者绑定方法的功能
        // 如果不需要初始化属性或者绑定方法，就不需要构造器
        // constructor(props) {
        //     super()
        //     this.state = {
        //         name: 'initial name',
        //     }
        //     this.handleClick = this.handleClick.bind(this);
        // }
        class Children extends React.Component {
            constructor(props) {
                super(props)
            }
            // componentWillReceiveProps(nextProps) {
            //     // 即使组件的属性并没有发生更改，也会触发，此事需要比较this.props和nextProps
            //     // 来判断组件是否发生改变
            //     console.log(this.props);
            //     console.log('--------------------');
            //     console.log(nextProps);
            // }
            render() {
                return (
                    <div>
                        <h3>I am Children</h3>
                        <p>{this.props.age}</p>
                    </div>
                )
            }
        }

        class Father extends React.Component {
            constructor(props) {
                super(props)
                this.state = {
                    age: 18,
                    name: '小明',
                }
                this.handleClick = this.handleClick.bind(this);
            }
            handleClick() {
                // this.setState(
                //     {
                //         age: this.state.age+1,
                //         name: '小红',
                //     }, 
                //     () => {
                //         console.log('-----------setState after-------------------------');
                //         console.log(this.state.age);
                //         console.log(this.state.name);
                //     }
                // )
                // 先执行后边的代码
                // console.log('--------------after setState-----------------');
                // console.log(this.state.age);
                // console.log(this.state.name);

                // 相当于object.assign({},{age:19},{age:19}):会将相同的属性进行合并，并不会每次点击+2
                // this.setState({age: this.state.age+1});
                // this.setState({age: this.state.age+1});

                // 官方推荐写法：(保证数据的同步性，之后的状态要依赖于之前的状态)
                // 这样更改之后会立即生效
                this.setState((prevState,props) => {
                    // prevState:当前的this.state
                    // console.log(prevState,props);

                    // 必须要将修改的内容return,否则不会生效
                    return {age: prevState.age+1}
                })
                this.setState((prevState,props) => {
                    return {age: prevState.age+1}
                })
            }
            render() {
                return (
                    <div>
                        <h1>I am Father</h1>
                        <Children age={this.state.age} title={'hello'} color={'red'} />
                        <button onClick={this.handleClick}>点击</button>
                    </div>
                )
            }
        }

        ReactDOM.render(<Father />,document.getElementById('app'))
    </script>
</body>

</html>